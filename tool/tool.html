<!DOCTYPE html>
<html lang="zh-cn">

<head>
	<script src="jquery-3.3.1.min.js"></script>
	<script src="go_judger.js"></script>
	<style type="text/css">
	* { margin: 0; padding: 0; }
	.selected { background-color: #ccc; }
	</style>
</head>
<body>
	<div>
		<div style="width: 800px; height: 800px; background: #c88f03" />
		<canvas id="board" width="800px" height="800px" />
	</div>
	<div style="position: absolute; left: 800px; top: 0;">
		<p>
		标题:<input type="text" id="title" />
		<input type="radio" name="init_color_sel" value="1" checked="checked"/>黑先
		<input type="radio" name="init_color_sel" value="0" />白先
		</p>
		

		<p>
		<input type="radio" name="mode_sel" value="0" checked="checked"/>录入棋子
		<input type="radio" name="mode_sel" value="2" />录入变化
		</p>
		<p>	
		<input type="radio" name="color_sel" value="1" checked="checked"/>黑棋
		<input type="radio" name="color_sel" value="0" />白棋
		</p>
		
		<div>
			<ol id="cache_predict"></ol>
			<button id="add_correct" type="button">添加为正确答案</button>
			<button id="add_error" type="button">添加为错误答案</button>
			<button id="clear_cache" type="button">清空</button>
		</div>
		
		
		解说：<input type="text" id="text" /><button id="set_text" type="button">添加解说</button>

		
		<button id="finish" type="button">生成结果</button>
		
		<div id="result">

		</div>
		
		<canvas id="tmp_board" width="100px" height="100px" />
		
	</div>

	
<script src="board.js"></script>
<script>
	window.onload=function() {
		result.title = "title";
		result.content = "content";
		result.board = {};
		result.board.info = {};
		result.board.answer = [];
		result.board.stone = {black:[], white:[]};
		result.board.predict = {};
	
		board = Board();
		board.init();
		judger = GoJudger();
		judger.init();
	}
	
	addStone = function(x, y, color, note) {
	  let deads = judger.addStone(x, y, color);
      if (deads === false) {
        console.log('add stone error');
        return false;
      }
      board.addStone(x, y, color, note);
      for (let i = 0; i != deads.length; ++i)
        board.removeStone(deads[i].x, deads[i].y);
	  return true;
	}
	
	$("#board").click(function(event){
		var mode = parseInt($('input:radio[name="mode_sel"]:checked').val());	

        //标准的获取鼠标点击相对于canvas画布的坐标公式
        var x = event.pageX - document.getElementById("board").getBoundingClientRect().left;
        var y = event.pageY - document.getElementById("board").getBoundingClientRect().top;
		var text = $('#text').val();
		var color = $('input:radio[name="color_sel"]:checked').val();		

		x = parseInt(x / 40 - 0.5),
        y = parseInt(y / 40 - 0.5);
		if (x >= 19) {
		  --x;
		}
		if (y >= 19) {
          --y;
		}
		
		
        console.log(x, y);
		if (!addStone(x, y, color, mode==2?''+cache.length:''))
			return;
			
		switch (mode) {
			case 0:
				if (color == 0) 
					result.board.stone.white.push({"x":x, "y":y});
				else
					result.board.stone.black.push({"x":x, "y":y});
			break;
			case 1:
				result.board.answer.push({"x":x, "y":y, "color":color, "text":text});
				if (color == 0)
					$('input[name="color_sel"]')[0].checked = true;
				else
					$('input[name="color_sel"]')[1].checked = true;
			break;
			case 2:
				let node = {"x":x, "y":y, "color":color, "text":text};
				let dom = $('<li class="predict_node"></li>');
				dom.text(JSON.stringify(node));
				dom.data('node', node);
				
				cache.push(node);
				if (color == 0)
					$('input[name="color_sel"]')[0].checked = true;
				else
					$('input[name="color_sel"]')[1].checked = true;
				$('#cache_predict').append(dom);
			break;
		}

		$('#result').text(JSON.stringify(result));
    });
</script>

</body>
</html>